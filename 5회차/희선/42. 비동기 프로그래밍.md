# 비동기 프로그래밍

## 동기 처리와 비동기 처리

함수가 호출될 때마다 스택 자료구조인 실행 컨텍스트 스택에 푸시되어 실행된다. 이처럼 함수의 실행 순서는 실행 컨텍스트 스택으로 관리한다.

자바스크립트 엔진은 `단 하나의 실행 컨텍스트 스택`을 갖는다.
즉 한 번에 하나의 테스크만 실행할 수 있는 `싱글 스레드 방식`으로 동작한다.

이로 인해 처리 시간이 오래 걸리는 테스크를 실행하는 경우 다른 테스크들은 `블로킹(작업중단)`이 발생한다.

이처럼 현재 실행 중인 테스크가 종료할 때까지 다음에 실행될 테스크가 대기하는 방식을 `동기 처리`라고 한다.

- 동기 처리 장단점
1. 장점 : 실행 순서 보장
2. 단점 : 앞선 테스크가 종료될 때까지 이후 테스크들이 블로킹되는 것

현재 실행 중인 태스크가 종료되지 않은 상태라 해도 다음 테스크를 곧바로 실행하는 방식을 `비동기 처리` 라고 한다.

- 비동기 처리 장단점
1. 장점 : 블로킹이 발생하지 않음
2. 단점 : 실행 순서가 보장되지 않음

타이머 함수인 setTimeout, setInterval, HTTP 요청, 이벤트 핸들러는 비동기 처리 방식으로 동작한다.

## 이벤트 루프와 태스크 큐

`이벤트 루프` : 자바스크립트의 동시성을 지원함

### 자바스크립트 엔진 구성요소

1. 콜 스택 : 

    실행 컨텍스트 스택
    
    함수를 호출하면 함수 실행 컨텍스트가 순차적으로 콜 스택에 푸시되어 순차적으로 실행됨. 최상위 실행 컨택스트가 종료되어 콜 스택에서 제거되기 전까지는 다른 어떤 태스크도 실행되지 않음.

2. 힙 : 

    런타임에 동적 할당되는 객체를 저장하는 공간

 
- 자바스크립트 엔진: 요청 작업을 순차적으로 실행
- 브라우저 또는 Node.js : 
 
    비동기 처리에서 소스 코드의 평가와 실행을 제외한 모든 처리는 자바스크립트 엔진을 구동하는 환경인 브라우저 또는 Node.js가 담당한다.

### 브라우저 환경

1. 테스크 큐 : 

    setTimeout / setInterval과 같은 비동기 함수의 콜백 함수 또는 이벤트 핸들러가 일시적으로 보관되는 영역

2. 이벤트 루프 :

    루프 순서<bt/>
    1. 콜 스택에 현재 실행 중인 실행 컨텍스트가 있는지, 테스크 큐에 대기 중인 함수가 있는 지 반복해서 확인함.

    2. 만약 콜 스택이 비어있고, 테스크 큐에 대기 중인 함수가 있다면 이벤트 루프는 순차적으로 테스크 큐에 대기 중인 함수를 콜 스택으로 이동시킴. 
    
    3. 콜 스택으로 이동한 함수는 실행됨. 즉 태스크 큐에 일시 보관된 함수들은 비동기 처리 방식으로 동작함.

따라서 브라우저에 내장된 `자바스크립트 엔진은 싱글 스레드`로 동작하지만 `브라우저는 멀티 스레드`로 동작함. 


